---
layout: post
bigtitle: 'ì´í™í‹°ë¸Œ ìë°” ì™„ë²½ ê³µëµ 1ë¶€'
subtitle: ì•„ì´í…œ 8. finalizerì™€ cleaner ì‚¬ìš©ì„ í”¼í•˜ë¼
date: '2026-01-22 00:00:01 +0900'
categories:
- effective-java1
comments: true

---

# ì•„ì´í…œ 8. finalizerì™€ cleaner ì‚¬ìš©ì„ í”¼í•˜ë¼

# ì•„ì´í…œ 8. finalizerì™€ cleaner ì‚¬ìš©ì„ í”¼í•˜ë¼

* toc
{:toc}

ìë°”ì—ì„œ ê°ì²´ì˜ ìƒëª… ì£¼ê¸°ëŠ” GCê°€ ê´€ë¦¬í•˜ì§€ë§Œ,
**ìì›ì˜ ìƒëª… ì£¼ê¸°ê¹Œì§€ GCì— ë§¡ê¸°ëŠ” ìˆœê°„ ìœ„í—˜í•´ì§„ë‹¤.**
`finalizer`ì™€ `cleaner`ëŠ” ê·¸ ëŒ€í‘œì ì¸ ì˜ˆë‹¤.

ìë°”ì—ì„œ ìì› ì •ë¦¬ëŠ” ìƒê°ë³´ë‹¤ ìœ„í—˜í•œ ì£¼ì œë‹¤.
ê²‰ë³´ê¸°ì—ëŠ” â€œGCê°€ ì•Œì•„ì„œ ì •ë¦¬í•´ì£¼ê² ì§€â€ë¼ëŠ” ìœ í˜¹ì´ ê°•í•˜ì§€ë§Œ, finalizerì™€ cleanerëŠ” ê·¸ ê¸°ëŒ€ë¥¼ ì •ë©´ìœ¼ë¡œ ë°°ì‹ í•œë‹¤.

ì´ ì•„ì´í…œì˜ í•µì‹¬ ë©”ì‹œì§€ëŠ” ë‹¨ìˆœí•˜ë‹¤.

ìì›ì„ ë°˜ë‚©í•´ì•¼ í•˜ëŠ” í´ë˜ìŠ¤ëŠ” AutoCloseableì„ êµ¬í˜„í•˜ê³ ,
í´ë¼ì´ì–¸íŠ¸ê°€ ëª…ì‹œì ìœ¼ë¡œ close()ë¥¼ í˜¸ì¶œí•˜ê²Œ í•˜ë¼.

ê·¸ ì™¸ì˜ ë°©ë²•ì€ ëª¨ë‘ â€œì•ˆì „ë§â€ì¼ ë¿ì´ë‹¤.

---

## í•µì‹¬ ì •ë¦¬

* `finalizer`ì™€ `cleaner`ëŠ” **ì¦‰ì‹œ ìˆ˜í–‰ëœë‹¤ëŠ” ë³´ì¥ì´ ì—†ë‹¤**
* ê²½ìš°ì— ë”°ë¼ **ì•„ì˜ˆ ì‹¤í–‰ë˜ì§€ ì•Šì„ ìˆ˜ë„ ìˆë‹¤**
* `finalizer` ì‹¤í–‰ ì¤‘ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ **ì •ë¦¬ ì‘ì—…ì´ ì²˜ë¦¬ë˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤**
* ë‘ ë©”ì»¤ë‹ˆì¦˜ ëª¨ë‘ **ì‹¬ê°í•œ ì„±ëŠ¥ ë¬¸ì œë¥¼ ìœ ë°œí•  ìˆ˜ ìˆë‹¤**
* `finalizer`ëŠ” **ë³´ì•ˆ ì·¨ì•½ì (finalizer attack)**ì˜ ì›ì¸ì´ ëœë‹¤
* ìì›ì„ ë°˜ë‚©í•´ì•¼ í•˜ëŠ” í´ë˜ìŠ¤ëŠ” ë°˜ë“œì‹œ
  **`AutoCloseable`ì„ êµ¬í˜„í•˜ê³ , `close()` í˜¸ì¶œ ë˜ëŠ” `try-with-resources`ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤**

---

## finalizerì˜ ë¬¸ì œì 

```java
public class FinalizerIsBad {

    @Override
    protected void finalize() throws Throwable {
        System.out.print("");
    }
}
```

`finalize()`ëŠ” ê°ì²´ê°€ GC ëŒ€ìƒì´ ë˜ì—ˆì„ ë•Œ **í˜¸ì¶œë  ìˆ˜ë„ ìˆëŠ” ë©”ì„œë“œ**ë‹¤.
ì–¸ì œ ì‹¤í–‰ë ì§€, ì‹¬ì§€ì–´ ì‹¤í–‰ë ì§€ì¡°ì°¨ **ì „í˜€ ë³´ì¥ë˜ì§€ ì•ŠëŠ”ë‹¤**.

---

### finalizer í ì ì²´ ë¬¸ì œ

```java
public class App {

    /**
     * ì½”ë“œ ì°¸ê³  https://www.baeldung.com/java-finalize
     */
    public static void main(String[] args) throws InterruptedException, ClassNotFoundException, NoSuchFieldException, IllegalAccessException {
        int i = 0;
        while(true) {
            i++;
            new FinalizerIsBad();

            if ((i % 1_000_000) == 0) {
                Class<?> finalizerClass = Class.forName("java.lang.ref.Finalizer");
                Field queueStaticField = finalizerClass.getDeclaredField("queue");
                queueStaticField.setAccessible(true);
                ReferenceQueue<Object> referenceQueue = (ReferenceQueue) queueStaticField.get(null);

                Field queueLengthField = ReferenceQueue.class.getDeclaredField("queueLength");
                queueLengthField.setAccessible(true);
                long queueLength = (long) queueLengthField.get(referenceQueue);
                System.out.format("There are %d references in the queue%n", queueLength);
            }
        }
    }
}
```

* `finalize()`ê°€ ì •ì˜ëœ ê°ì²´ëŠ” **Finalizer í**ë¡œ ì´ë™í•œë‹¤
* ì´ íëŠ” **ë‹¨ì¼ ìŠ¤ë ˆë“œ**ì—ì„œ ì²˜ë¦¬ëœë‹¤
* ê°ì²´ ìƒì„± ì†ë„ê°€ ì²˜ë¦¬ ì†ë„ë¥¼ ì•ì§€ë¥´ë©´ íê°€ ë¹ ë¥´ê²Œ ì ì²´ëœë‹¤
* ê·¸ ê²°ê³¼ GC ì§€ì—°, ë©”ëª¨ë¦¬ ì¦ê°€, ì „ì²´ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„±ëŠ¥ ì €í•˜ë¡œ ì´ì–´ì§„ë‹¤

### ë³´ì•ˆ ë¬¸ì œ: Finalizer Attack

ìƒì„±ìê°€ ì˜ˆì™¸ë¥¼ ë˜ì ¸ ê°ì²´ ìƒì„±ì´ ì‹¤íŒ¨í–ˆëŠ”ë°ë„,
finalize()ê°€ ì‹¤í–‰ë˜ë©´ì„œ ë¯¸ì™„ì„± ê°ì²´ì— ì ‘ê·¼ ê°€ëŠ¥í•´ì§€ëŠ” ë¬¸ì œê°€ ìˆë‹¤.

ê·¸ë˜ì„œ ë³´ì•ˆì ìœ¼ë¡œ ì¤‘ìš”í•œ í´ë˜ìŠ¤ëŠ” ì•„ì˜ˆ finalize()ë¥¼ ë‘ë©´ ì•ˆ ëœë‹¤.

---

## Cleaner ì‚¬ìš©ë²•

CleanerëŠ” Java 9ë¶€í„° ë„ì…ë˜ì—ˆì§€ë§Œ,
**finalizerì˜ ì•ˆì „í•œ ëŒ€ì²´ì¬ê°€ ì•„ë‹ˆë¼ â€œì œí•œì ì¸ ë³´ì¡° ìˆ˜ë‹¨â€**ì— ê°€ê¹ë‹¤.

### Cleanerì˜ ì •ì²´
+ ë‚´ë¶€ì ìœ¼ë¡œ PhantomReference ì‚¬ìš©
+ ê°ì²´ê°€ GC ëŒ€ìƒì´ ë˜ë©´ ë°±ê·¸ë¼ìš´ë“œ ìŠ¤ë ˆë“œì—ì„œ Runnable ì‹¤í–‰
+ ì‹¤í–‰ ë³´ì¥ ì—†ìŒ (ì¤‘ìš”)

### ìì› ë°˜ë‚©ìš© ì•ˆì „ë§ìœ¼ë¡œ ì‚¬ìš©

* ë‚´ë¶€ì ìœ¼ë¡œ `PhantomReference`ë¥¼ ì‚¬ìš©í•œë‹¤
* ê°ì²´ê°€ GC ëŒ€ìƒì´ ëœ ì´í›„ì— ë™ì‘í•œë‹¤
* í˜¸ì¶œ ì—¬ë¶€ëŠ” ì—¬ì „íˆ ë³´ì¥ë˜ì§€ ì•ŠëŠ”ë‹¤
* ë‹¤ë§Œ `close()` í˜¸ì¶œì„ ë†“ì³¤ì„ ë•Œì˜ **ìµœí›„ì˜ ì•ˆì „ë§**ìœ¼ë¡œëŠ” ì˜ë¯¸ê°€ ìˆë‹¤

### ë„¤ì´í‹°ë¸Œ í”¼ì–´(native peer) ìì› íšŒìˆ˜

* JNIë¡œ í• ë‹¹ëœ ë©”ëª¨ë¦¬
* OS ë ˆë²¨ ë¦¬ì†ŒìŠ¤
* ë„¤ì´í‹°ë¸Œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë‚´ë¶€ ìƒíƒœ ë“±

ë‹¨, ë‹¤ìŒ ì¡°ê±´ì„ ë§Œì¡±í•´ì•¼ í•œë‹¤.

* ì„±ëŠ¥ ì €í•˜ë¥¼ ê°ë‹¹í•  ìˆ˜ ìˆì„ ê²ƒ
* ë„¤ì´í‹°ë¸Œ í”¼ì–´ê°€ **ì¹˜ëª…ì ì¸ ìì›**ì„ ë“¤ê³  ìˆì§€ ì•Šì„ ê²ƒ
* ì¦‰ì‹œ íšŒìˆ˜ë˜ì§€ ì•Šì•„ë„ ì‹œìŠ¤í…œì— ë¬¸ì œê°€ ì—†ì„ ê²ƒ

ğŸ‘‰ **ì¦‰ì‹œ ìì› íšŒìˆ˜ê°€ í•„ìš”í•˜ë‹¤ë©´ Cleanerê°€ ì•„ë‹ˆë¼ `close()`ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.**

---

### ì˜ëª»ëœ Cleaner ì‚¬ìš© ì˜ˆ

```java
public class BigObject {

    private List<Object> resource;

    public BigObject(List<Object> resource) {
        this.resource = resource;
    }

    public static class ResourceCleaner implements Runnable {

        private List<Object> resourceToClean;

        public ResourceCleaner(List<Object> resourceToClean) {
            this.resourceToClean = resourceToClean;
        }

        @Override
        public void run() {
            resourceToClean = null;
            System.out.println("cleaned up.");
        }
    }
}
```

```java
public class CleanerIsNotGood {

    public static void main(String[] args) throws InterruptedException {
        Cleaner cleaner = Cleaner.create();

        List<Object> resourceToCleanUp = new ArrayList<>();
        BigObject bigObject = new BigObject(resourceToCleanUp);
        cleaner.register(bigObject, new BigObject.ResourceCleaner(resourceToCleanUp));

        bigObject = null;
        System.gc();
        Thread.sleep(3000L);
    }
}
```

* `System.gc()` í˜¸ì¶œì— ì˜ì¡´í•œë‹¤
* ì‹¤í–‰ ì—¬ë¶€ê°€ ë¶ˆí™•ì‹¤í•˜ë‹¤
* ì¦‰ì‹œ ìì› ë°˜ë‚©ì´ ë¶ˆê°€ëŠ¥í•˜ë‹¤
  â†’ ì£¼ ìì› ê´€ë¦¬ ë°©ì‹ìœ¼ë¡œëŠ” ë¶€ì ì ˆí•˜ë‹¤

---

## Cleaner + AutoCloseable íŒ¨í„´

```java
// cleaner ì•ˆì „ë§ì„ ê°–ì¶˜ ìì›ì„ ì œëŒ€ë¡œ í™œìš©í•˜ëŠ” í´ë¼ì´ì–¸íŠ¸
public class Adult {
    public static void main(String[] args) {
        try (Room myRoom = new Room(7)) {
            System.out.println("ì•ˆë…•~");
        }
    }
}
```

```java
// ì½”ë“œ 8-1 cleanerë¥¼ ì•ˆì „ë§ìœ¼ë¡œ í™œìš©í•˜ëŠ” AutoCloseable í´ë˜ìŠ¤
public class Room implements AutoCloseable {
    private static final Cleaner cleaner = Cleaner.create();

    // ì²­ì†Œê°€ í•„ìš”í•œ ìì›. ì ˆëŒ€ Roomì„ ì°¸ì¡°í•´ì„œëŠ” ì•ˆ ëœë‹¤!
    private static class State implements Runnable {
        int numJunkPiles;

        State(int numJunkPiles) {
            this.numJunkPiles = numJunkPiles;
        }

        @Override public void run() {
            System.out.println("Cleaning room");
            numJunkPiles = 0;
        }
    }

    private final State state;
    private final Cleaner.Cleanable cleanable;

    public Room(int numJunkPiles) {
        state = new State(numJunkPiles);
        cleanable = cleaner.register(this, state);
    }

    @Override public void close() {
        cleanable.clean();
    }
}
```

* ì •ìƒì ì¸ ê²½ìš° `close()`ê°€ ì¦‰ì‹œ ìì›ì„ ë°˜ë‚©í•œë‹¤
* `close()`ê°€ í˜¸ì¶œë˜ì§€ ì•Šì•˜ì„ ê²½ìš°ì—ë§Œ Cleanerê°€ ì•ˆì „ë§ ì—­í• ì„ í•œë‹¤

---

```java
// cleaner ì•ˆì „ë§ì„ ê°–ì¶˜ ìì›ì„ ì œëŒ€ë¡œ í™œìš©í•˜ì§€ ëª»í•˜ëŠ” í´ë¼ì´ì–¸íŠ¸
public class Teenager {

    public static void main(String[] args) {
        new Room(99);
        System.out.println("Peace out");

        // GC í˜¸ì¶œì— ì˜ì¡´í•´ì„œëŠ” ì•ˆ ëœë‹¤
        System.gc();
    }
}
```

---

## ê¶Œì¥í•˜ëŠ” AutoCloseable

* ìì›ì„ ë³´ìœ í•œ í´ë˜ìŠ¤ëŠ” ë°˜ë“œì‹œ `AutoCloseable`ì„ êµ¬í˜„í•´ì•¼ í•œë‹¤
* ì‚¬ìš©ìëŠ” `try-with-resources`ë¡œ ìì› ì‚¬ìš© ë²”ìœ„ë¥¼ ëª…í™•íˆ í•´ì•¼ í•œë‹¤

```java
public class AutoClosableIsGood implements Closeable {

    private BufferedReader reader;

    public AutoClosableIsGood(String path) {
        try {
            this.reader = new BufferedReader(new FileReader(path));
        } catch (FileNotFoundException e) {
            throw new IllegalArgumentException(path);
        }
    }

    @Override
    public void close() {
        try {
            reader.close();
        } catch (IOException e) {
            throw new RuntimeException(e);
        }
    }
}
```

```java
public class App {

    public static void main(String[] args) {
        try (AutoClosableIsGood good = new AutoClosableIsGood("")) {
            // ìì› ì‚¬ìš©
        } // ìë™ ë°˜ë‚©
    }
}
```

---

## ì™„ë²½ ê³µëµ

* p42: Finalizer ê³µê²©
* p43: AutoCloseableì˜ í•„ìš”ì„±
* p45: ì •ì ì´ ì•„ë‹Œ ì¤‘ì²© í´ë˜ìŠ¤ëŠ” ë°”ê¹¥ ê°ì²´ì˜ ì°¸ì¡°ë¥¼ ê°€ì§„ë‹¤
* p45: ëŒë‹¤ ì—­ì‹œ ë°”ê¹¥ ê°ì²´ì˜ ì°¸ì¡°ë¥¼ ê°–ê¸° ì‰½ë‹¤

---

## ì •ì ì´ ì•„ë‹Œ ì¤‘ì²© í´ë˜ìŠ¤ì˜ ë¬¸ì œì 

```java
class InnerClass {
    public void hello() {
        OuterClass.this.hi();
    }
}
```

* non-static ì¤‘ì²© í´ë˜ìŠ¤ëŠ” ìë™ìœ¼ë¡œ ë°”ê¹¥ ê°ì²´ ì°¸ì¡°ë¥¼ ê°€ì§„ë‹¤
* Cleanerì˜ Runnableì´ ë°”ê¹¥ ê°ì²´ë¥¼ ì°¸ì¡°í•˜ë©´ GCê°€ ë¶ˆê°€ëŠ¥í•´ì§„ë‹¤
* ë”°ë¼ì„œ Cleanerì—ì„œ ì‚¬ìš©í•˜ëŠ” Runnableì€ **ë°˜ë“œì‹œ static ì¤‘ì²© í´ë˜ìŠ¤ì—¬ì•¼ í•œë‹¤**
* Cleanerì˜ Runnableì´ outer ê°ì²´ë¥¼ ì°¸ì¡°í•˜ë©´?
  * GC ë¶ˆê°€
  * Cleanerê°€ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ 
  * ìì› ëˆ„ìˆ˜

---

## ëŒë‹¤ ì—­ì‹œ ë°”ê¹¥ ê°ì²´ë¥¼ ìº¡ì²˜í•œë‹¤

```java
private Runnable instanceLambda = () -> {
    System.out.println(value);
};
```

* ëŒë‹¤ëŠ” ë°”ê¹¥ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‰½ê²Œ ìº¡ì²˜í•œë‹¤
* ê²°ê³¼ì ìœ¼ë¡œ this ì°¸ì¡°ê°€ ìˆ¨ì–´ ë“¤ì–´ê°„ë‹¤
* Cleanerì—ì„œ ì‚¬ìš©í•˜ë©´ ìˆœí™˜ ì°¸ì¡°ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤
* Cleaner ì‘ì—…ì—ëŠ” ëŒë‹¤ ì‚¬ìš©ì„ í”¼í•´ì•¼ í•œë‹¤

---


## Finalizer ê³µê²© (Finalizer Attack)
ë§Œë“¤ë‹¤ ë§Œ ê°ì²´ë¥¼ finalize ë©”ì†Œë“œì—ì„œ ì‚¬ìš©í•˜ëŠ” ë°©ë²•

Finalizer ê³µê²©ì€ **â€œìƒì„±ì— ì‹¤íŒ¨í•œ ê°ì²´ë¥¼ finalizeì—ì„œ ì‚¬ìš©í•˜ëŠ” ê³µê²© ê¸°ë²•â€**ì´ë‹¤.
ê°ì²´ ìƒì„±ì´ ì •ìƒì ìœ¼ë¡œ ëë‚˜ì§€ ì•Šì•˜ìŒì—ë„, `finalize()`ê°€ í˜¸ì¶œë˜ë©´ì„œ
**ì˜ë„í•˜ì§€ ì•Šì€ ë©”ì„œë“œ ì‹¤í–‰ì´ ê°€ëŠ¥í•´ì§€ëŠ” ì¹˜ëª…ì ì¸ ë³´ì•ˆ ë¬¸ì œ**ë‹¤.

---

### ê³µê²© ê°œë…

* ìƒì„±ìì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•´ **ê°ì²´ê°€ ì™„ì „íˆ ë§Œë“¤ì–´ì§€ì§€ ì•ŠìŒ**
* ê·¸ëŸ¼ì—ë„ GC ê³¼ì •ì—ì„œ `finalize()`ê°€ í˜¸ì¶œë¨
* í•˜ìœ„ í´ë˜ìŠ¤ì—ì„œ `finalize()`ë¥¼ ì˜¤ë²„ë¼ì´ë”©í•˜ì—¬
  **ë³´ì•ˆì ìœ¼ë¡œ ì¤‘ìš”í•œ ë©”ì„œë“œë¥¼ ì‹¤í–‰**

ì¦‰, **â€œë§Œë“¤ë‹¤ ë§Œ ê°ì²´â€ë¥¼ ì´ìš©í•œ ê³µê²©**ì´ë‹¤.

---

### ê³µê²© ëŒ€ìƒ ì½”ë“œ

```java
public class Account {

    private String accountId;

    public Account(String accountId) {
        this.accountId = accountId;

        if (accountId.equals("í‘¸í‹´")) {
            throw new IllegalArgumentException("í‘¸í‹´ì€ ê³„ì •ì„ ë§‰ìŠµë‹ˆë‹¤.");
        }
    }

    public void transfer(BigDecimal amount, String to) {
        System.out.printf("transfer %f from %s to %s\n", amount, accountId, to);
    }
}
```

ì˜ë„:

* `"í‘¸í‹´"`ì´ë¼ëŠ” ê³„ì •ì€ ìƒì„± ë‹¨ê³„ì—ì„œ ì°¨ë‹¨
* ìƒì„±ìê°€ ì˜ˆì™¸ë¥¼ ë˜ì§€ë¯€ë¡œ ê°ì²´ëŠ” **ì •ìƒ ìƒì„±ë˜ì§€ ì•Šì•„ì•¼ í•¨**

---

### ê³µê²© ì½”ë“œ (í•˜ìœ„ í´ë˜ìŠ¤)

```java
public class BrokenAccount extends Account {

    public BrokenAccount(String accountId) {
        super(accountId);
    }

    @Override
    protected void finalize() throws Throwable {
        this.transfer(BigDecimal.valueOf(100), "keesun");
    }
}
```

#### ë¬´ìŠ¨ ì¼ì´ ë²Œì–´ì§€ëŠ”ê°€?

1. `new BrokenAccount("í‘¸í‹´")`
2. ë¶€ëª¨ ìƒì„±ìì—ì„œ ì˜ˆì™¸ ë°œìƒ â†’ **ê°ì²´ ìƒì„± ì‹¤íŒ¨**
3. í•˜ì§€ë§Œ GC ê³¼ì •ì—ì„œ `finalize()`ëŠ” í˜¸ì¶œë  ìˆ˜ ìˆìŒ
4. `transfer()` ì‹¤í–‰
   â†’ **ì°¨ë‹¨ë˜ì–´ì•¼ í•  ê³„ì¢Œì—ì„œ ì†¡ê¸ˆ ë°œìƒ**

ğŸ‘‰ ìƒì„±ì ê²€ì¦ ë¡œì§ì´ **ì™„ì „íˆ ë¬´ë ¥í™”**ëœë‹¤.

---

### ì™œ ì´ëŸ° ì¼ì´ ê°€ëŠ¥í•œê°€?

* `finalize()`ëŠ” **ìƒì„±ì ì‹¤í–‰ ì—¬ë¶€ì™€ ë¬´ê´€í•˜ê²Œ í˜¸ì¶œë  ìˆ˜ ìˆë‹¤**
* ìƒì„±ìê°€ ì‹¤íŒ¨í–ˆì–´ë„,
  JVM ì…ì¥ì—ì„œëŠ” â€œí™ì— í• ë‹¹ëœ ê°ì²´â€ë¡œ ì¸ì‹
* í•˜ìœ„ í´ë˜ìŠ¤ì—ì„œ `finalize()`ë¥¼ ì¬ì •ì˜í•˜ë©´
  **ë³´ì•ˆ ë¡œì§ì„ ìš°íšŒí•  ìˆ˜ ìˆëŠ” ì‹¤í–‰ ê²½ë¡œê°€ ì—´ë¦°ë‹¤**

ì´ ë•Œë¬¸ì— Effective Javaì—ì„œëŠ”
**finalizerë¥¼ â€œë³´ì•ˆì ìœ¼ë¡œ ì¹˜ëª…ì ì¸ ê¸°ëŠ¥â€**ì´ë¼ê³  ëª…ì‹œí•œë‹¤.

---

## Finalizer ê³µê²© ë°©ì–´ ë°©ë²•

### 1. ìƒì†ì„ í—ˆìš©í•˜ì§€ ì•ŠëŠ” ê²½ìš° (ê°€ì¥ ê°•ë ¥í•œ ë°©ë²•)

```java
public final class Account {
    ...
}
```

* í´ë˜ìŠ¤ ìì²´ë¥¼ `final`ë¡œ ì„ ì–¸
* í•˜ìœ„ í´ë˜ìŠ¤ ìƒì„± ë¶ˆê°€
* Finalizer ê³µê²© **ì›ì²œ ì°¨ë‹¨**

---

### 2. ìƒì†ì´ í•„ìš”í•œ ê²½ìš°

ìƒì†ì€ í—ˆìš©í•˜ë˜,
**`finalize()`ë§Œí¼ì€ ì¬ì •ì˜í•  ìˆ˜ ì—†ê²Œ ë§‰ëŠ”ë‹¤.**

```java
@Override
protected final void finalize() throws Throwable {
    // ì•„ë¬´ ì¼ë„ í•˜ì§€ ì•ŠìŒ
}
```

#### ì´ ë°©ì‹ì˜ íš¨ê³¼

* `final` ë©”ì„œë“œëŠ” í•˜ìœ„ í´ë˜ìŠ¤ì—ì„œ ì˜¤ë²„ë¼ì´ë”© ë¶ˆê°€
* ìƒì†ì€ ê°€ëŠ¥í•˜ì§€ë§Œ `finalize()` ê³µê²© ê²½ë¡œ ì°¨ë‹¨
* ê²°ê³¼ì ìœ¼ë¡œ Finalizer ê³µê²© ë°©ì–´ ê°€ëŠ¥

---

### ì •ë¦¬

* Finalizer ê³µê²©ì€
  **â€œìƒì„±ì ì‹¤íŒ¨ + finalize ì¬ì •ì˜â€ ì¡°í•©ì—ì„œ ë°œìƒ**
* ë³´ì•ˆì ìœ¼ë¡œ ì¤‘ìš”í•œ í´ë˜ìŠ¤ì— `finalize()`ê°€ ì¡´ì¬í•˜ëŠ” ìˆœê°„
  **ê³µê²© í‘œë©´ì´ ì—´ë¦°ë‹¤**
* ê°€ì¥ ì¢‹ì€ í•´ê²°ì±…ì€
  ğŸ‘‰ **ì• ì´ˆì— finalizerë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²ƒ**
* ë¶ˆê°€í”¼í•˜ë‹¤ë©´
  ğŸ‘‰ **`final` í´ë˜ìŠ¤ ë˜ëŠ” `final finalize()`ë¡œ ë°©ì–´**

---


## AutoCloseable

`AutoCloseable`ì€ **try-with-resources ë¬¸ë²•ì„ ì§€ì›í•˜ê¸° ìœ„í•œ ì¸í„°í˜ì´ìŠ¤**ë‹¤.
ì´ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ ê°ì²´ëŠ” `try` ë¸”ë¡ì´ ì¢…ë£Œë˜ëŠ” ì‹œì ì—
**ìë™ìœ¼ë¡œ `close()`ê°€ í˜¸ì¶œë˜ì–´ ìì›ì„ ë°˜ë‚©**í•˜ê²Œ ëœë‹¤.

ì¦‰, ìë°”ì—ì„œ **ìì› ìƒëª… ì£¼ê¸°ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ê´€ë¦¬í•˜ê¸° ìœ„í•œ í‘œì¤€ ê³„ì•½**ì´ë‹¤.

---

### AutoCloseableì˜ í•µì‹¬ ë©”ì„œë“œ

```java
void close() throws Exception
```

* `close()`ëŠ” ìì›ì„ ë°˜ë‚©í•˜ëŠ” ì±…ì„ì„ ê°€ì§„ ë©”ì„œë“œë‹¤
* ì¸í„°í˜ì´ìŠ¤ ì •ì˜ìƒ `Exception`ì„ ë˜ì§ˆ ìˆ˜ ìˆë„ë¡ ë˜ì–´ ìˆë‹¤
* í•˜ì§€ë§Œ **êµ¬í˜„ì²´ì—ì„œëŠ” ë‹¤ìŒì„ ê¶Œì¥í•œë‹¤**

  * ê°€ëŠ¥í•œ í•œ **êµ¬ì²´ì ì¸ ì˜ˆì™¸ íƒ€ì…ì„ ë˜ì§ˆ ê²ƒ**
  * ë” ë‚˜ì•„ê°€, ê°€ëŠ¥í•˜ë‹¤ë©´ **ì˜ˆì™¸ë¥¼ ë˜ì§€ì§€ ì•Šë„ë¡ êµ¬í˜„í•  ê²ƒ**

#### ì´ìœ 

* `try-with-resources`ì—ì„œëŠ” ì—¬ëŸ¬ ìì›ì´ ì¤‘ì²©ë  ìˆ˜ ìˆë‹¤
* ì´ë•Œ `close()`ì—ì„œ ë°œìƒí•œ ì˜ˆì™¸ëŠ”

  * ê¸°ì¡´ ì˜ˆì™¸ë¥¼ ê°€ë¦¬ê±°ë‚˜
  * suppressed exceptionìœ¼ë¡œ ë°€ë ¤ë‚  ìˆ˜ ìˆë‹¤
* ìì› ì •ë¦¬ ê³¼ì •ì—ì„œ ì˜ˆì™¸ê°€ ë‚¨ë°œë˜ë©´ **ë””ë²„ê¹…ê³¼ ì˜¤ë¥˜ ì¶”ì ì´ ì–´ë ¤ì›Œì§„ë‹¤**

ğŸ‘‰ **close()ëŠ” â€œì‹¤íŒ¨ ê°€ëŠ¥ì„±ì´ ë‚®ê³ , ì¡°ìš©í•´ì•¼ í•˜ëŠ” ë©”ì„œë“œâ€**ë‹¤.

---

## Closeableê³¼ì˜ ì°¨ì´ì 

`Closeable`ì€ `AutoCloseable`ì˜ í•˜ìœ„ ì¸í„°í˜ì´ìŠ¤ë‹¤.

```java
public interface Closeable extends AutoCloseable {
    void close() throws IOException;
}
```

### ì°¨ì´ì  ì •ë¦¬

#### 1. ë˜ì§€ëŠ” ì˜ˆì™¸ íƒ€ì…

* `AutoCloseable`

  * `Exception`
  * ë²”ìš© ì¸í„°í˜ì´ìŠ¤
* `Closeable`

  * `IOException`
  * I/O ìì›(File, Stream, Socket ë“±)ì— íŠ¹í™”

ğŸ‘‰ **I/O ê³„ì—´ ìì›ì´ë¼ë©´ `Closeable`ì„ êµ¬í˜„í•˜ëŠ” ê²ƒì´ ì˜ë¯¸ìƒ ë” ì ì ˆí•˜ë‹¤**

---

#### 2. idempotent(ë©±ë“±ì„±) ìš”êµ¬ ì‚¬í•­

* `Closeable`ì˜ `close()`ëŠ” **ë°˜ë“œì‹œ idempotent í•´ì•¼ í•œë‹¤**

  * ì—¬ëŸ¬ ë²ˆ í˜¸ì¶œí•´ë„ ê²°ê³¼ê°€ ê°™ì•„ì•¼ í•œë‹¤
  * ì´ë¯¸ ë‹«íŒ ìì›ì„ ë‹¤ì‹œ ë‹«ì•„ë„ ë¬¸ì œê°€ ì—†ì–´ì•¼ í•œë‹¤
* `AutoCloseable`ì—ëŠ” **ëª…ì‹œì ì¸ ë©±ë“±ì„± ìš”êµ¬ëŠ” ì—†ë‹¤**

  * í•˜ì§€ë§Œ ì‹¤ë¬´ì—ì„œëŠ” ë™ì¼í•˜ê²Œ ë©±ë“±ì„±ì„ ì§€í‚¤ëŠ” ê²ƒì´ ê°•ë ¥íˆ ê¶Œì¥ëœë‹¤

```java
// ì¢‹ì€ close() êµ¬í˜„ì˜ íŠ¹ì§•
@Override
public void close() {
    if (closed) {
        return;
    }
    closed = true;
    // ìì› ë°˜ë‚©
}
```

---

## ì–¸ì œ ë¬´ì—‡ì„ ì¨ì•¼ í• ê¹Œ?

* **íŒŒì¼, ìŠ¤íŠ¸ë¦¼, ì†Œì¼“ ë“± I/O ìì›**
  â†’ `Closeable`
* **DB ì»¤ë„¥ì…˜, ë½, ë„¤ì´í‹°ë¸Œ ìì›, ë…¼ë¦¬ì  ë¦¬ì†ŒìŠ¤**
  â†’ `AutoCloseable`

ê³µí†µ ì›ì¹™ì€ í•˜ë‚˜ë‹¤.

> **ìì›ì„ ì§ì ‘ ë“¤ê³  ìˆë‹¤ë©´
> ë°˜ë“œì‹œ AutoCloseable ê³„ì—´ì„ êµ¬í˜„í•˜ë¼.**

---

### ì´ ì„¹ì…˜ì˜ í•µì‹¬ ë©”ì‹œì§€

* `AutoCloseable`ì€ try-with-resourcesë¥¼ ìœ„í•œ **ìì› ê´€ë¦¬ ê³„ì•½**
* `close()`ëŠ”

  * ê°€ëŠ¥í•œ í•œ ì˜ˆì™¸ë¥¼ ë˜ì§€ì§€ ë§ê³ 
  * ë˜ì§„ë‹¤ë©´ êµ¬ì²´ì ìœ¼ë¡œ
  * ë°˜ë“œì‹œ ë©±ë“±ì ìœ¼ë¡œ êµ¬í˜„í•  ê²ƒ
* Cleanerë‚˜ finalizerë³´ë‹¤
  **ëª…ì‹œì ì¸ `close()`ê°€ í•­ìƒ ìš°ì„ **ì´ë‹¤

---

