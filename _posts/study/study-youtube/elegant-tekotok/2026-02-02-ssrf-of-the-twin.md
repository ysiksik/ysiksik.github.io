---
layout: post
bigtitle: 'ìš°ì•„í•œí…Œí¬ì½”ìŠ¤ í…Œì½”í†¡'
subtitle: ê¾¹ì´ì˜ SSRF
date: '2026-02-02 00:00:01 +0900'
categories:
    - elegant-tekotok
comments: true

---

# ê¾¹ì´ì˜ SSRF
[https://youtu.be/wYIdOgrSW0E?si=bDIvHOkK9l_2fvMI](https://youtu.be/wYIdOgrSW0E?si=bDIvHOkK9l_2fvMI)

â€” ì„œë²„ê°€ ëŒ€ì‹  ìš”ì²­í•˜ëŠ” ìˆœê°„, ê³µê²©ì´ ì‹œì‘ëœë‹¤

ì´ ê¸€ì€ ê¾¹ì´ì˜ SSRF ì˜ìƒì„ ë³´ê³  ì •ë¦¬í•œ ë‚´ìš©ì—
**ì‹¤ë¬´ ê´€ì ì—ì„œ ì™œ ìœ„í—˜í•œì§€, ì™œ ìì£¼ í„°ì§€ëŠ”ì§€**ë¥¼ ë³´ê°•í•œ ê¸€ì´ë‹¤.

SSRFëŠ” í™”ë ¤í•œ í•´í‚¹ ê¸°ë²•ì´ ì•„ë‹ˆë¼,
**â€œì„œë²„ê°€ ë„ˆë¬´ ì¹œì ˆí•  ë•Œâ€** ë°œìƒí•˜ëŠ” ì·¨ì•½ì ì´ë‹¤.


# ê¾¹ì´ì˜ SSRF
* toc
{:toc}

  
---

## OWASP

* OWASP(Open Worldwide Application Security Project)ëŠ”
  ì• í”Œë¦¬ì¼€ì´ì…˜ ë³´ì•ˆì„ ì—°êµ¬Â·ì „íŒŒí•˜ëŠ” ë¹„ì˜ë¦¬ êµ­ì œ ë‹¨ì²´
* OWASPì—ì„œ ë°œí‘œí•˜ëŠ” ìë£Œ ì¤‘ ê°€ì¥ ë„ë¦¬ ì•Œë ¤ì§„ ê²ƒì´ **OWASP TOP 10**

  * OWASP TOP 10ì€ ì•½ 4~5ë…„ ì£¼ê¸°ë¡œ ë°œí‘œ
  * ì‹¤ì œ ê³µê²© í†µê³„ + ë³´ì•ˆ ì „ë¬¸ê°€ ì˜ê²¬ì„ ë°”íƒ•ìœ¼ë¡œ
    ê°€ì¥ ìœ„í—˜í•˜ê³  ë¹ˆë²ˆí•œ ì·¨ì•½ì  10ê°€ì§€ë¥¼ ì •ë¦¬

### OWASP TOP 10 (2021)

* ë¶€ì ì ˆí•œ ì¸ê°€
* ì•”í˜¸í™” ì‹¤íŒ¨
* Injection (ì‚½ì… ê³µê²©)
* ì•ˆì „í•˜ì§€ ì•Šì€ ì„¤ê³„
* ë³´ì•ˆ ì„¤ì • ë¯¸í¡
* ì·¨ì•½í•˜ê³  ì—…ë°ì´íŠ¸ë˜ì§€ ì•Šì€ ì»´í¬ë„ŒíŠ¸ ì‚¬ìš©
* ì‹ë³„ ë° ì¸ì¦ ì‹¤íŒ¨
* ì†Œí”„íŠ¸ì›¨ì–´ ë° ë°ì´í„° ë¬´ê²°ì„± ì‹¤íŒ¨
* ë³´ì•ˆ ë¡œê¹… ë° ëª¨ë‹ˆí„°ë§ ì‹¤íŒ¨
* **ì„œë²„ ì‚¬ì´ë“œ ìš”ì²­ ìœ„ì¡° (SSRF)**

ğŸ‘‰ SSRFëŠ” íŠ¹íˆ **í´ë¼ìš°ë“œ í™˜ê²½**ì—ì„œ ìœ„í—˜ë„ê°€ ê¸‰ê²©íˆ ì˜¬ë¼ê°„ë‹¤.

---

## SSRF

* SSRF(Server-Side Request Forgery)ëŠ”
  **ê³µê²©ìê°€ ì„œë²„ê°€ ëŒ€ì‹  ìš”ì²­ì„ í•˜ë„ë¡ ì¡°ì‘í•˜ëŠ” ê³µê²©**

ì¤‘ìš”í•œ í¬ì¸íŠ¸ëŠ” ì´ê±°ë‹¤.

> ê³µê²©ìëŠ” ì§ì ‘ ë‚´ë¶€ë§ì— ì ‘ê·¼í•˜ì§€ ì•ŠëŠ”ë‹¤
> **ì„œë²„ì˜ ê¶Œí•œì„ ë¹Œë ¤ ì ‘ê·¼í•œë‹¤**

---

### SSRF ê³µê²© íë¦„

1. ê³µê²©ìëŠ” ë¨¼ì € **í”„ë¼ì´ë¹— ì„œë¸Œë„·**ì— ì ‘ê·¼í•˜ë ¤ê³  í•œë‹¤
2. ì´ ì„œë¸Œë„·ì€ ì™¸ë¶€ ì¸í„°ë„·ì—ì„œ ì§ì ‘ ì ‘ê·¼í•  ìˆ˜ ì—†ë‹¤
3. ê³µê²©ìëŠ” ì•…ì˜ì ì¸ ìš”ì²­ì„ ë³´ë‚´
   **ì·¨ì•½ ì„œë²„ê°€ ëŒ€ì‹  ìš”ì²­í•˜ë„ë¡ ìœ ë„**
4. ì·¨ì•½ ì„œë²„ëŠ” ë‚´ë¶€ ë°ì´í„° ì„œë²„ë¡œ ìš”ì²­
5. ë°ì´í„° ì„œë²„ëŠ” â€œì‹ ë¢°ëœ ì„œë²„ ìš”ì²­â€ì´ë¼ íŒë‹¨í•˜ê³  ì‘ë‹µ
6. ì‘ë‹µì€ ë‹¤ì‹œ ê³µê²©ìì—ê²Œ ì „ë‹¬ëœë‹¤

#### ë£¨í”„ë°± ê³µê²©

* `127.0.0.1`, `localhost`ë¥¼ ì´ìš©
* ì·¨ì•½ ì„œë²„ê°€ **ìê¸° ìì‹ ì—ê²Œ ìš”ì²­**
* ë‚´ë¶€ ê´€ë¦¬ì API, ì„¤ì • ì •ë³´ ë…¸ì¶œ ê°€ëŠ¥

ğŸ‘‰ **ì‹ ë¢° ê²½ê³„ë¥¼ ìš°íšŒí•˜ëŠ” êµ¬ì¡°**ê°€ SSRFì˜ ë³¸ì§ˆì´ë‹¤.

---

## ì–´ë– í•œ ìš”ì²­ì´ ì„œë²„ë¡œ í•˜ì—¬ê¸ˆ ëŒ€ì‹  ìš”ì²­í•˜ê²Œ ë§Œë“œëŠ”ê°€

SSRFëŠ” â€œíŠ¹ë³„í•œ ê³µê²© ìš”ì²­â€ì´ ì•„ë‹ˆë¼
**ì·¨ì•½í•œ ì½”ë“œ ì„¤ê³„**ì—ì„œ ì‹œì‘ëœë‹¤.

### SSRF ì·¨ì•½ì  ì˜ˆì‹œ ì½”ë“œ

```java
@GetMapping("/fetch-data")
public ResponseEntity<String> fetchData(@RequestParam String url) {
    RestTemplate restTemplate = new RestTemplate();
    String response = restTemplate.getForObject(url, String.class);
    return ResponseEntity.ok(response);
}
```

* `url` íŒŒë¼ë¯¸í„°ëŠ” **ì™¸ë¶€ ì…ë ¥ê°’**
* ì„œë²„ëŠ” ì´ ê°’ì„ ê²€ì¦ ì—†ì´ ì‚¬ìš©
* ê³µê²©ìëŠ” ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ ì£¼ì†Œë¥¼ ì£¼ì… ê°€ëŠ¥

#### ê³µê²© ì˜ˆì‹œ

* `http://localhost:8080/admin`
* `http://127.0.0.1:8080/internal`
* `http://169.254.169.254/latest/meta-data/`

---

## í´ë¼ìš°ë“œ í™˜ê²½ì—ì„œ SSRFê°€ íŠ¹íˆ ìœ„í—˜í•œ ì´ìœ 

### ì¸ìŠ¤í„´ìŠ¤ ë©”íƒ€ë°ì´í„° ê³µê²©

* `http://169.254.169.254/latest/meta-data/`
* EC2 ì¸ìŠ¤í„´ìŠ¤ ë©”íƒ€ë°ì´í„° ì¡°íšŒ ì£¼ì†Œ

ì´ ì£¼ì†Œë¥¼ í†µí•´ ë…¸ì¶œë  ìˆ˜ ìˆëŠ” ì •ë³´:

* IAM Role
* Security Credentials
* Public IP
* Security Group
* ê²½ìš°ì— ë”°ë¼ **S3 ì ‘ê·¼ ê¶Œí•œ**

ğŸ‘‰ SSRF = **í´ë¼ìš°ë“œ ê¶Œí•œ íƒˆì·¨ì˜ ì¶œë°œì **

AWSë¿ ì•„ë‹ˆë¼:

* GCP
* Azure
  ëª¨ë‘ ìœ ì‚¬í•œ ë©”íƒ€ë°ì´í„° ì„œë¹„ìŠ¤ê°€ ì¡´ì¬í•œë‹¤.

---

## SSRF ê³µê²© ëŒ€ì‘ ë°©ì•ˆ

### ë¸”ë™ ë¦¬ìŠ¤íŠ¸

* ì˜ˆì™¸ì ìœ¼ë¡œ **ì°¨ë‹¨í•  ëŒ€ìƒì„ ì§€ì •**í•˜ëŠ” ë°©ì‹
* ì°¨ë‹¨ ê¶Œì¥ í•­ëª©

  * IP ì£¼ì†Œ
  * ë„ë©”ì¸
  * URL íŒ¨í„´
  * í˜¸ìŠ¤íŠ¸ ì´ë¦„
  * í¬íŠ¸ ë²ˆí˜¸
  * í”„ë¡œí† ì½œ
  * IP ëŒ€ì—­

```java
@GetMapping("/fetch-data")
public ResponseEntity<String> fetchData(@RequestParam String url) {
    if (isBlacklisted(url)) {
        return ResponseEntity.status(HttpStatus.FORBIDDEN)
            .body("Access to this URL is forbidden.");
    }
    RestTemplate restTemplate = new RestTemplate();
    String response = restTemplate.getForObject(url, String.class);
    return ResponseEntity.ok(response);
}
```

#### ë¸”ë™ë¦¬ìŠ¤íŠ¸ì˜ í•œê³„

* â€œì•Œê³  ìˆëŠ” ìœ„í—˜â€ë§Œ ë§‰ì„ ìˆ˜ ìˆë‹¤
* ìš°íšŒ ê²½ë¡œê°€ ì¡´ì¬

---

#### ë¸”ë™ë¦¬ìŠ¤íŠ¸ íšŒí”¼ ë°©ì‹ (ë¦¬ë‹¤ì´ë ‰íŠ¸)

* ê³µê²©ìëŠ” ì¤‘ê°„ ì„œë²„ë¥¼ ì¤€ë¹„
* ì·¨ì•½ ì„œë²„ëŠ” ê³µê²©ì ì„œë²„ë¡œ ìš”ì²­
* ê³µê²©ì ì„œë²„ëŠ” **302 Redirect**ë¡œ ë‚´ë¶€ ì£¼ì†Œ ë°˜í™˜
* ì·¨ì•½ ì„œë²„ê°€ ë¦¬ë‹¤ì´ë ‰íŠ¸ë¥¼ ë”°ë¼ê°€ë©° ë‚´ë¶€ ì ‘ê·¼

```java
// ê³µê²©ìê°€ ì˜ˆì‹œë¡œ ì´ë ‡ê²Œ ì·¨ì•½ ì„œë²„ì— ì´ë ‡ê²Œ ìš”ì²­ com?url=http://attacker.com/redirect
@GetMapping("/redirect")
public ResponseEntity<Void> redirectToMetadata() {
    HttpHeaders headers = new HttpHeaders();
    headers.setLocation(
        URI.create("http://169.254.169.254/latest/meta-data/")
    );
    return ResponseEntity.status(HttpStatus.FOUND)
        .headers(headers)
        .build();
}
```

ğŸ‘‰ **ë¦¬ë‹¤ì´ë ‰íŠ¸ ì°¨ë‹¨ì€ í•„ìˆ˜**

---

### í™”ì´íŠ¸ ë¦¬ìŠ¤íŠ¸

* ëª…ì‹œì ìœ¼ë¡œ í—ˆìš©ëœ ìš”ì²­ë§Œ í†µê³¼
* ë³´ì•ˆ ìˆ˜ì¤€ì€ ìƒëŒ€ì ìœ¼ë¡œ ë†’ìŒ

```java
@GetMapping("/fetch-data")
public ResponseEntity<String> fetchData(@RequestParam String url) {
    if (!isSafe(url)) {
        return ResponseEntity.status(HttpStatus.FORBIDDEN)
            .body("Access to this URL is forbidden.");
    }
    RestTemplate restTemplate = new RestTemplate();
    String response = restTemplate.getForObject(url, String.class);
    return ResponseEntity.ok(response);
}
```

---

#### í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ íšŒí”¼ â€” DNS Rebinding

1. ê³µê²©ìëŠ” ìì‹ ì˜ DNS ì„œë²„ ì‚¬ìš©
2. ìµœì´ˆ DNS ì‘ë‹µ â†’ ì •ìƒ IP (TTL ë§¤ìš° ì§§ìŒ)
3. ì„œë²„ëŠ” ê²€ì¦ í†µê³¼
4. TTL ë§Œë£Œ
5. ì¬ì¡°íšŒ ì‹œ ë‚´ë¶€ IP ë°˜í™˜
6. ì„œë²„ëŠ” ë‚´ë¶€ ì„œë¹„ìŠ¤ë¡œ ìš”ì²­

ğŸ‘‰ **ê²€ì¦ ì‹œì ê³¼ ìš”ì²­ ì‹œì ì˜ IP ë¶ˆì¼ì¹˜**ê°€ ê³µê²© í¬ì¸íŠ¸

---

### IMDSv2 (AWS ê¸°ì¤€)

* Instance Metadata Service Version 2
* EC2 ê¸°ë³¸ ì„¤ì •ì´ IMDSv1(Optional)ì¸ ê²½ìš° SSRFì— ì·¨ì•½

#### IMDSv1

* GET ìš”ì²­ë§Œìœ¼ë¡œ ë©”íƒ€ë°ì´í„° ì¡°íšŒ ê°€ëŠ¥

#### IMDSv2

* PUT ìš”ì²­ìœ¼ë¡œ í† í° ë°œê¸‰
* í† í°ì„ í—¤ë”ì— í¬í•¨í•´ì•¼ ì ‘ê·¼ ê°€ëŠ¥
* ë‹¨ìˆœ GET ê¸°ë°˜ SSRF ë°©ì–´ íš¨ê³¼ í¼

---

#### Metadata Hop Limit

* ìš”ì²­ì´ ê±°ì¹  ìˆ˜ ìˆëŠ” ë„¤íŠ¸ì›Œí¬ hop ì œí•œ
* ê¸°ë³¸ê°’: 1

ê³µê²©ì ì„œë²„ â†’ ì·¨ì•½ ì„œë²„ â†’ ë©”íƒ€ë°ì´í„°
â†’ hop ì´ˆê³¼ë¡œ ì°¨ë‹¨

ğŸ‘‰ **ë¦¬ë‹¤ì´ë ‰íŠ¸ ê¸°ë°˜ SSRF ë°©ì–´ ê°€ëŠ¥**

---

## ì½”ë“œë¥¼ ì„¤ê³„í•  ë•Œ ë°˜ë“œì‹œ ì¸ì§€í•´ì•¼ í•  ì 

* ì™¸ë¶€ ì…ë ¥ìœ¼ë¡œ URLì„ ë°›ëŠ” ìˆœê°„ SSRF ê°€ëŠ¥ì„± ì¡´ì¬
* HTTP Client(`RestTemplate`, `WebClient`) ì‚¬ìš© ì‹œ í•­ìƒ ì˜ì‹¬
* IDE ê²½ê³ , SAST ë¶„ì„ ê²°ê³¼ ë¬´ì‹œí•˜ì§€ ì•Šê¸°
* â€œì´ ìš”ì²­ì€ ì •ë§ ì„œë²„ê°€ í•´ì•¼ í•˜ëŠ”ê°€?â€ ì§ˆë¬¸í•˜ê¸°

---

## ì •ë¦¬

* SSRFëŠ” ì„œë²„ì˜ ê¶Œí•œì„ ì•…ìš©í•˜ëŠ” ê³µê²©
* ë‹¨ì¼ ë°©ì–´ì±…ì€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤
* ë¸”ë™ë¦¬ìŠ¤íŠ¸ + í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ + ë¦¬ë‹¤ì´ë ‰íŠ¸ ì°¨ë‹¨
* í´ë¼ìš°ë“œ í™˜ê²½ì—ì„œëŠ” **IMDSv2 í•„ìˆ˜**
* ë¬´ì—‡ë³´ë‹¤ **ì„¤ê³„ ë‹¨ê³„ì—ì„œì˜ ì¸ì‹ì´ ê°€ì¥ ì¤‘ìš”**

> SSRFëŠ”
> ì„œë²„ê°€ ë„ˆë¬´ ë¯¿ì–´ì¤€ ê²°ê³¼ë‹¤.

---



